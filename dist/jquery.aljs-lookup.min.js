if("undefined"==typeof jQuery.aljs)throw new Error("Please include the ALJS initializer file");!function(e){var s='<div class="slds-lookup__menu" role="listbox"><ul class="slds-lookup__list" role="presentation"></ul></div>',t='<div class="slds-lookup__item"><button class="slds-button"><svg aria-hidden="true" class="slds-icon slds-icon-text-default slds-icon--small"><use xlink:href="{{assetsLocation}}/assets/icons/utility-sprite/svg/symbols.svg#search"></use></svg>&quot;{{searchTerm}}&quot; in {{objectPluralLabel}}</button></div>',l='<div class="slds-lookup__item"><button class="slds-button"><svg aria-hidden="true" class="slds-icon slds-icon-text-default slds-icon--small"><use xlink:href="{{assetsLocation}}/assets/icons/utility-sprite/svg/symbols.svg#add"></use></svg>Add {{objectLabel}}</button></div>',i='<li class="slds-lookup__item"><a id="{{resultId}}" href="#" role="option"><svg aria-hidden="true" class="slds-icon slds-icon-standard-account slds-icon--small"><use xlink:href="{{objectIconUrl}}"></use></svg>{{resultLabel}}</a></li>',n=function(s,t){this.$el=e(s),this.$lookupContainer=this.$el.closest(".slds-lookup"),this.settings=t,this.isStringEmpty(t.searchTerm)||this.$el.val(t.searchTerm),this.initLookup()};n.prototype={constructor:n,isStringEmpty:function(e){return null===e||"undefined"==typeof e||""===e.trim()},initLookup:function(){this.$el.on("focus",this,this.runSearch).on("keyup",this,this.runSearch).on("blur",this,this.handleBlur)},runSearch:function(e){var s=e.data,t=s.$el.val();s.isStringEmpty(t)?s.getDefaultResults():s.getSearchTermResults(t)},getSearchTermResults:function(e){var s=this;if(this.settings.items.length>0)this.searchResults=this.settings.items.filter(function(s){return null!==s.label.match(e)}),this.renderSearchResults();else{var t=function(e){s.searchResults=e,s.renderSearchResults()};this.settings.filledSearchTermQuery(e,t)}},getDefaultResults:function(){var e=this;if(this.settings.items.length>0)this.searchResults=this.settings.items,this.renderSearchResults();else{var s=function(s){e.searchResults=s,e.renderSearchResults()};this.settings.emptySearchTermQuery(s)}},renderSearchResults:function(){this.$lookupSearchContainer&&(this.$lookupSearchContainer.remove(),this.$lookupSearchContainer=null);var n=e(s),o=n.find("ul.slds-lookup__list"),a=this.$el.val(),r=this;if(!this.isStringEmpty(a)&&a.length>1&&o.append(t.replace("{{searchTerm}}",a).replace("{{objectPluralLabel}}",this.settings.objectPluralLabel).replace("{{assetsLocation}}",e.aljs.assetsLocation)),this.searchResults.forEach(function(e){o.append(i.replace("{{resultLabel}}",e.label).replace("{{resultId}}",e.id).replace("{{objectIconUrl}}",r.settings.objectIconUrl))}),this.settings.clickAddFunction){o.append(l.replace("{{objectLabel}}",this.settings.objectLabel).replace("{{assetsLocation}}",e.aljs.assetsLocation))}o.on("click","a",this,this.clickResult),this.$lookupSearchContainer=n,n.appendTo(this.$lookupContainer)},handleBlur:function(s){var t=s.data;0===e(s.relatedTarget).closest(".slds-lookup__menu").length&&t.$lookupSearchContainer&&(t.$lookupSearchContainer.remove(),t.$lookupSearchContainer=null)},clickResult:function(s){var t=s.data,l=e(this).attr("id");t.selectResult(l)},selectResult:function(e){var s=this.searchResults.filter(function(s){return s.id==e});this.selectedResult=s.length>0?s[0]:null,this.$lookupSearchContainer.remove(),this.$lookupSearchContainer=null,this.$el.val(this.selectedResult.label)}},e.fn.lookup=function(s){var t,l=arguments,i=e.extend({assetsLocation:e.aljs.assetsLocation,objectPluralLabel:"Stuffs",objectLabel:"Stuff",objectIconUrl:"assets/icons/standard-sprite/svg/symbols.svg#account",searchTerm:"",items:[],emptySearchTermQuery:function(){callback([])},filledSearchTermQuery:function(e,s){s([])},clickAddFunction:null},"object"==typeof s?s:{});if(this.each(function(){var o=e(this),a=o.data("aljs-lookup");if(!a){var r=new n(this,i);o.data("aljs-lookup",a=r)}"string"==typeof s&&(t=a[s](l[1],l[2]))}),void 0===t||t instanceof Picklist)return this;if(this.length>1)throw new Error("Using only allowed for the collection of a single element ("+option+" function)");return t}}(jQuery);